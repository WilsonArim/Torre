{
  "order_id": "mg2-2025-11-01T16-21-00",
  "created_at": "2025-11-02T10:29:18.354930Z",
  "total_queries": 5,
  "queries": [
    {
      "query_id": "ad70192f0deb6ec5",
      "query": "ART-01",
      "timestamp": "2025-11-02T10:29:18.772070Z",
      "results_count": 5,
      "results": [
        {
          "file": "core/orquestrador/sop_cli.py",
          "matches": [
            {
              "line": 18,
              "context": "- relatorios/relatorio_sop.md + relatorios/sop_status.json (status PASS/BLOQUEADO + m√©tricas).\n\nRespeita ART-01 (Integridade), ART-02 (Tr√≠ade), ART-04 (Verificabilidade), ART-07 (Transpar√™ncia), ART-09 (Evid√™ncia)\n\"\"\"\nimport argparse"
            },
            {
              "line": 376,
              "context": "    \n    problematic_patterns = [\n        (r\"rm\\s+-rf|shutil\\.rmtree\\(|\\.unlink\\(.*force\\s*=\\s*True\", \"ART-01: Comando de remo√ß√£o for√ßada pode violar Integridade\"),\n        (r\"eval\\(|exec\\(|__import__\\(\", \"ART-05: C√≥digo din√¢mico pode violar N√£o-Autonomia\"),\n        (r\"while\\s+True:\\s*$|for\\s+.*:\\s*pass\\s*$\", \"ART-05: Loop infinito pode violar N√£o-Autonomia\"),"
            },
            {
              "line": 501,
              "context": "        \n        # Verificar se exce√ß√£o tenta sobrepor Constitui√ß√£o\n        if \"constituicao\" in regra.lower() or \"art-01\" in regra.lower():\n            incongruencias.append({\n                \"tipo\": \"Exce√ß√£o Constitucional\","
            },
            {
              "line": 506,
              "context": "                \"severidade\": \"CRITICAL\",\n                \"local\": \"core/sop/exceptions.yaml\",\n                \"problema\": f\"Exce√ß√£o '{regra}' tenta sobrepor Constitui√ß√£o (ART-01)\",\n                \"acao\": \"ART-01: Remover exce√ß√£o - Constitui√ß√£o √© imut√°vel\",\n            })"
            },
            {
              "line": 507,
              "context": "                \"local\": \"core/sop/exceptions.yaml\",\n                \"problema\": f\"Exce√ß√£o '{regra}' tenta sobrepor Constitui√ß√£o (ART-01)\",\n                \"acao\": \"ART-01: Remover exce√ß√£o - Constitui√ß√£o √© imut√°vel\",\n            })\n    "
            },
            {
              "line": 530,
              "context": "            \"\",\n            \"Todos os artefactos analisados est√£o em conformidade com:\",\n            \"- Constitui√ß√£o (ART-01 a ART-10)\",\n            \"- Tr√≠ade de Fundamenta√ß√£o (ART-02)\",\n            \"- Leis e pol√≠ticas definidas\","
            }
          ],
          "constitutional_relevance": true,
          "score": 16
        },
        {
          "file": "Torre/orquestrador/exec_fase0.py",
          "matches": [
            {
              "line": 30,
              "context": "print(\"üß© Etapa: Prepara√ß√£o ‚Äî OK\")\n\n# Step 1: Estudar ART-01 a ART-10\nprint(\"üß† Execu√ß√£o t√©cnica ‚Äî Estudando Constitui√ß√£o...\")\nconstitucao_content = CONSTITUICAO_PATH.read_text(encoding=\"utf-8\") if CONSTITUICAO_PATH.exists() else \"\""
            },
            {
              "line": 36,
              "context": "# Extrair artigos\nartigos = []\nif \"ART-01\" in constitucao_content:\n    for i in range(1, 11):\n        art_id = f\"ART-{i:02d}\""
            }
          ],
          "constitutional_relevance": true,
          "score": 12
        },
        {
          "file": "factory/pins/_deprecated/engineer_executor.py",
          "matches": [
            {
              "line": 5,
              "context": "PIN ‚Äî ENGENHEIRO DA TORRE v1.0\nExecutor t√©cnico da TORRE - Implementa ciclo completo de execu√ß√£o de ordens\nRespeita ART-01, ART-02, ART-03, ART-04, ART-07, ART-09, ART-10\n\"\"\"\n"
            }
          ],
          "constitutional_relevance": true,
          "score": 11
        },
        {
          "file": "Torre/orquestrador/exec_mg2.py",
          "matches": [
            {
              "line": 173,
              "context": "\ntest_queries = [\n    \"ART-01\",\n    \"Constitui√ß√£o da F√ÅBRICA\",\n    \"Gatekeeper\","
            }
          ],
          "constitutional_relevance": true,
          "score": 11
        },
        {
          "file": "Torre/cli/validate_dataset.py",
          "matches": [
            {
              "line": 52,
              "context": "    # Verificar que n√£o altera Constitui√ß√£o\n    if \"constitui√ß√£o.yaml\" in str(dataset_path) and \"modif\" in str(dataset_path).lower():\n        violations.append(\"Tentativa de modificar Constitui√ß√£o (ART-01: Integridade)\")\n    \n    return {"
            }
          ],
          "constitutional_relevance": true,
          "score": 11
        }
      ],
      "sources": [
        "core/orquestrador/sop_cli.py",
        "Torre/orquestrador/exec_fase0.py",
        "factory/pins/_deprecated/engineer_executor.py",
        "Torre/orquestrador/exec_mg2.py",
        "Torre/cli/validate_dataset.py"
      ]
    },
    {
      "query_id": "02bea4049ffd2e20",
      "query": "Constitui√ß√£o da F√ÅBRICA",
      "timestamp": "2025-11-02T10:29:20.741610Z",
      "results_count": 3,
      "results": [
        {
          "file": "Torre/orquestrador/exec_mg2.py",
          "matches": [
            {
              "line": 174,
              "context": "test_queries = [\n    \"ART-01\",\n    \"Constitui√ß√£o da F√ÅBRICA\",\n    \"Gatekeeper\",\n    \"SOP valida√ß√£o\","
            }
          ],
          "constitutional_relevance": true,
          "score": 11
        },
        {
          "file": "core/sop/constitui√ß√£o.yaml",
          "matches": [
            {
              "line": 2,
              "context": "versao: 1\ntitulo: \"CONSTITUI√á√ÉO DA F√ÅBRICA\"\ndescricao: >\n  Documento supremo da F√ÅBRICA. Define os princ√≠pios imut√°veis de integridade,"
            }
          ],
          "constitutional_relevance": true,
          "score": 11
        },
        {
          "file": ".github/workflows/ci.yml",
          "matches": [
            {
              "line": 19,
              "context": "          if git diff --name-only HEAD~1 HEAD 2>/dev/null | grep -q \"core/sop/constitui√ß√£o.yaml\"; then\n            echo \"‚ö†Ô∏è ERRO CR√çTICO: Tentativa de modifica√ß√£o da Constitui√ß√£o detectada!\"\n            echo \"A Constitui√ß√£o da F√ÅBRICA √© imut√°vel e n√£o pode ser alterada.\"\n            echo \"Nenhum agente, humano ou LLM pode modificar core/sop/constitui√ß√£o.yaml\"\n            exit 1"
            }
          ],
          "constitutional_relevance": true,
          "score": 11
        }
      ],
      "sources": [
        "Torre/orquestrador/exec_mg2.py",
        "core/sop/constitui√ß√£o.yaml",
        ".github/workflows/ci.yml"
      ]
    },
    {
      "query_id": "b4053fbdf55448e8",
      "query": "Gatekeeper",
      "timestamp": "2025-11-02T10:29:20.753685Z",
      "results_count": 5,
      "results": [
        {
          "file": "factory/pins/_deprecated/cli_gatekeeper_torre.py",
          "matches": [
            {
              "line": 184,
              "context": "\n\ndef cmd_gatekeeper_run() -> int:\n    \"\"\"Executa Gatekeeper.\"\"\"\n    log_message(\"Executando Gatekeeper\", \"INFO\")"
            },
            {
              "line": 185,
              "context": "\ndef cmd_gatekeeper_run() -> int:\n    \"\"\"Executa Gatekeeper.\"\"\"\n    log_message(\"Executando Gatekeeper\", \"INFO\")\n    "
            },
            {
              "line": 186,
              "context": "def cmd_gatekeeper_run() -> int:\n    \"\"\"Executa Gatekeeper.\"\"\"\n    log_message(\"Executando Gatekeeper\", \"INFO\")\n    \n    try:"
            },
            {
              "line": 191,
              "context": "        # Primeiro preparar inputs\n        prep_result = subprocess.run(\n            [sys.executable, str(CORE_ORQUESTRADOR / \"cli.py\"), \"gatekeeper_prep\"],\n            cwd=str(REPO_ROOT),\n            capture_output=True,"
            },
            {
              "line": 199,
              "context": "        \n        if prep_result.returncode != 0:\n            log_message(f\"ERRO ao preparar Gatekeeper: {prep_result.stderr}\", \"ERROR\")\n            return 1\n        "
            },
            {
              "line": 202,
              "context": "            return 1\n        \n        # Executar Gatekeeper\n        result = subprocess.run(\n            [sys.executable, str(CORE_ORQUESTRADOR / \"cli.py\"), \"gatekeeper_run\"],"
            },
            {
              "line": 204,
              "context": "        # Executar Gatekeeper\n        result = subprocess.run(\n            [sys.executable, str(CORE_ORQUESTRADOR / \"cli.py\"), \"gatekeeper_run\"],\n            cwd=str(REPO_ROOT),\n            capture_output=True,"
            },
            {
              "line": 216,
              "context": "        \n        if result.returncode == 0:\n            log_message(\"Gatekeeper executado com sucesso\", \"INFO\")\n        else:\n            log_message(f\"Gatekeeper emitiu VETO (returncode: {result.returncode})\", \"WARNING\")"
            },
            {
              "line": 218,
              "context": "            log_message(\"Gatekeeper executado com sucesso\", \"INFO\")\n        else:\n            log_message(f\"Gatekeeper emitiu VETO (returncode: {result.returncode})\", \"WARNING\")\n        \n        return result.returncode"
            },
            {
              "line": 223,
              "context": "        \n    except Exception as e:\n        log_message(f\"ERRO ao executar Gatekeeper: {e}\", \"ERROR\")\n        return 1\n"
            },
            {
              "line": 362,
              "context": "    sub.add_parser(\"pipeline_validate\", help=\"Valida pipeline\")\n    sub.add_parser(\"sop\", help=\"Executa valida√ß√£o SOP\")\n    sub.add_parser(\"gatekeeper_run\", help=\"Executa Gatekeeper\")\n    \n    # Comandos de ordens"
            },
            {
              "line": 376,
              "context": "    elif args.cmd == \"sop\":\n        return cmd_sop()\n    elif args.cmd == \"gatekeeper_run\":\n        return cmd_gatekeeper_run()\n    elif args.cmd == \"executa\":"
            },
            {
              "line": 377,
              "context": "        return cmd_sop()\n    elif args.cmd == \"gatekeeper_run\":\n        return cmd_gatekeeper_run()\n    elif args.cmd == \"executa\":\n        return cmd_executa_ordem()"
            }
          ],
          "constitutional_relevance": true,
          "score": 23
        },
        {
          "file": "factory/pins/_deprecated/engineer_executor.py",
          "matches": [
            {
              "line": 60,
              "context": "CORE_ORQUESTRADOR = REPO_ROOT / \"core\" / \"orquestrador\"\nORDENS_INDEX = REPO_ROOT / \"relatorios\" / \"ordens_index.json\"\nGATEKEEPER_IN = ORDERS_DIR / \"gatekeeper.in.yaml\"\nSOP_IN = ORDERS_DIR / \"sop.in.yaml\"\n"
            },
            {
              "line": 1016,
              "context": "    \n    # Frase de fechamento obrigat√≥ria (PIN v2.0)\n    print(\"‚úÖ RELAT√ìRIO EMITIDO ‚Äî Estado-Maior pode avaliar (Gatekeeper+SOP). Avan√ßo de gate s√≥ ap√≥s PASS.\")\n    \n    return report"
            },
            {
              "line": 1098,
              "context": "    # Checar mailboxes dos agentes antes de tudo\n    valid_engineer = validar_yaml_mailbox(ENGINEER_IN, \"ENGENHEIRO\")\n    valid_gatekeeper = validar_yaml_mailbox(GATEKEEPER_IN, \"GATEKEEPER\")\n    valid_sop = validar_yaml_mailbox(SOP_IN, \"SOP\")\n    if not (valid_engineer and valid_gatekeeper and valid_sop):"
            },
            {
              "line": 1100,
              "context": "    valid_gatekeeper = validar_yaml_mailbox(GATEKEEPER_IN, \"GATEKEEPER\")\n    valid_sop = validar_yaml_mailbox(SOP_IN, \"SOP\")\n    if not (valid_engineer and valid_gatekeeper and valid_sop):\n        print(\"‚õî Execu√ß√£o bloqueada: Mailboxes dos agentes precisam estar 100% corretos antes de avan√ßar!\")\n        return 3"
            },
            {
              "line": 1124,
              "context": "    \n    # MODO EXECU√á√ÉO\n    print(\"üõ†Ô∏è MODO EXECU√á√ÉO ‚Äî A executar a tarefa t√©cnica atribu√≠da (sem pap√©is de Gatekeeper/SOP).\")\n    print()\n    "
            },
            {
              "line": 1175,
              "context": "    order = get_latest_open_order()\n    if order:\n        print(\"üõ†Ô∏è MODO EXECU√á√ÉO ‚Äî A executar a tarefa t√©cnica atribu√≠da (sem pap√©is de Gatekeeper/SOP).\")\n    else:\n        print(\"üõ†Ô∏è MODO STANDBY ‚Äî A aguardar ordens v√°lidas do Estado-Maior.\")"
            }
          ],
          "constitutional_relevance": true,
          "score": 16
        },
        {
          "file": "Torre/orquestrador/exec_mg2.py",
          "matches": [
            {
              "line": 49,
              "context": "    r'Tr√≠ade',\n    r'SOP',\n    r'Gatekeeper',\n]\n"
            },
            {
              "line": 175,
              "context": "    \"ART-01\",\n    \"Constitui√ß√£o da F√ÅBRICA\",\n    \"Gatekeeper\",\n    \"SOP valida√ß√£o\",\n    \"Tr√≠ade White Paper\""
            },
            {
              "line": 257,
              "context": "\n### Filtro Constitucional\n- Padr√µes: ART-*, ARTIGO *, Constitui√ß√£o, Tr√≠ade, SOP, Gatekeeper\n- Relev√¢ncia constitucional aumenta score dos resultados\n"
            }
          ],
          "constitutional_relevance": true,
          "score": 13
        },
        {
          "file": "Torre/orquestrador/treino_G2.py",
          "matches": [
            {
              "line": 24,
              "context": "METRICS_FILE = TORRE_RELATORIOS / \"treino_G2_metrics.json\"\n\nprint(\"üõ†Ô∏è MODO EXECU√á√ÉO ‚Äî A executar a tarefa t√©cnica atribu√≠da (sem pap√©is de Gatekeeper/SOP).\")\nprint()\n"
            }
          ],
          "constitutional_relevance": true,
          "score": 11
        },
        {
          "file": "Torre/orquestrador/treino_G3.py",
          "matches": [
            {
              "line": 24,
              "context": "METRICS_FILE = TORRE_RELATORIOS / \"treino_G3_metrics.json\"\n\nprint(\"üõ†Ô∏è MODO EXECU√á√ÉO ‚Äî A executar a tarefa t√©cnica atribu√≠da (sem pap√©is de Gatekeeper/SOP).\")\nprint()\n"
            }
          ],
          "constitutional_relevance": true,
          "score": 11
        }
      ],
      "sources": [
        "factory/pins/_deprecated/cli_gatekeeper_torre.py",
        "factory/pins/_deprecated/engineer_executor.py",
        "Torre/orquestrador/exec_mg2.py",
        "Torre/orquestrador/treino_G2.py",
        "Torre/orquestrador/treino_G3.py"
      ]
    },
    {
      "query_id": "aa1bd165e55eafda",
      "query": "SOP valida√ß√£o",
      "timestamp": "2025-11-02T10:29:22.625247Z",
      "results_count": 1,
      "results": [
        {
          "file": "Torre/orquestrador/exec_mg2.py",
          "matches": [
            {
              "line": 176,
              "context": "    \"Constitui√ß√£o da F√ÅBRICA\",\n    \"Gatekeeper\",\n    \"SOP valida√ß√£o\",\n    \"Tr√≠ade White Paper\"\n]"
            }
          ],
          "constitutional_relevance": true,
          "score": 11
        }
      ],
      "sources": [
        "Torre/orquestrador/exec_mg2.py"
      ]
    },
    {
      "query_id": "74c95fb980f13ca4",
      "query": "Tr√≠ade White Paper",
      "timestamp": "2025-11-02T10:29:24.612354Z",
      "results_count": 1,
      "results": [
        {
          "file": "Torre/orquestrador/exec_mg2.py",
          "matches": [
            {
              "line": 177,
              "context": "    \"Gatekeeper\",\n    \"SOP valida√ß√£o\",\n    \"Tr√≠ade White Paper\"\n]\n"
            }
          ],
          "constitutional_relevance": true,
          "score": 11
        }
      ],
      "sources": [
        "Torre/orquestrador/exec_mg2.py"
      ]
    }
  ]
}